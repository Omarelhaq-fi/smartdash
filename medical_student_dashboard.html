<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All-in-One Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #1a202c; color: #e2e8f0; }
        .dark { background-color: #1a202c; color: #e2e8f0; }
        .light { background-color: #f7fafc; color: #2d3748; }
        .sidebar-icon { transition: all 0.2s ease-in-out; }
        .sidebar-icon:hover, .sidebar-icon.active { background-color: #2d3748; color: #38bdf8; }
        .pomodoro-dial { width: 250px; height: 250px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; background: conic-gradient(#38bdf8 0deg, #2d3748 0deg); }
        .pomodoro-dial::before { content: ''; position: absolute; width: 90%; height: 90%; background-color: #1a202c; border-radius: 50%; }
        .timer-display { position: relative; z-index: 1; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #4a5568; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #38bdf8; }
        input:checked + .slider:before { transform: translateX(22px); }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); }
        .modal-content { background-color: #2d3748; margin: 5% auto; padding: 2rem; border-radius: 0.5rem; width: 90%; max-width: 600px; position: relative; }
        .flashcard { perspective: 1000px; width: 100%; height: 250px; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard.is-flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; padding: 1rem; border-radius: 0.5rem; background-color: #4a5568; }
        .flashcard-back { transform: rotateY(180deg); }
        .tab-link.active { border-bottom-color: #38bdf8; color: #38bdf8; }
        #shot-chart-container { background-image: url('https://sporttutor.com/wp-content/uploads/2021/04/Basketball-Court-Dimensions-Measurements-1-1024x576.png'); background-size: contain; background-repeat: no-repeat; background-position: center; width: 100%; height: 0; padding-top: 56.25%; position: relative; cursor: crosshair; }
        .shot-dot { position: absolute; width: 12px; height: 12px; border-radius: 50%; transform: translate(-50%, -50%); border: 1px solid white; }
        .planner-cell { min-height: 80px; }
        .timeline-container { position: relative; height: 1440px; }
        .timeline-hour { position: relative; height: 60px; border-top: 1px solid #4a5568; }
        .timeline-hour-label { position: absolute; left: -50px; top: -10px; font-size: 0.75rem; color: #a0aec0; }
        .timeline-event { position: absolute; left: 10px; right: 10px; border-radius: 0.375rem; padding: 0.25rem 0.5rem; font-size: 0.875rem; overflow: hidden; border-left: 4px solid; }
    </style>
</head>
<body class="flex">

    <!-- Sidebar -->
    <nav class="w-20 bg-gray-900 h-screen p-4 flex flex-col items-center justify-between">
        <div>
            <div class="text-blue-400 text-2xl mb-12"><i class="fas fa-brain"></i></div>
            <ul class="space-y-6">
                <li><a href="#" class="sidebar-icon active p-3 rounded-lg block text-center" data-target="dashboard"><i class="fas fa-tachometer-alt fa-lg"></i></a></li>
                <li><a href="#" class="sidebar-icon p-3 rounded-lg block text-center" data-target="schedule"><i class="fas fa-calendar-check fa-lg"></i></a></li>
                <li><a href="#" class="sidebar-icon p-3 rounded-lg block text-center" data-target="subjects"><i class="fas fa-book-medical fa-lg"></i></a></li>
                <li><a href="#" class="sidebar-icon p-3 rounded-lg block text-center" data-target="courses"><i class="fas fa-chalkboard-teacher fa-lg"></i></a></li>
                <li><a href="#" class="sidebar-icon p-3 rounded-lg block text-center" data-target="pomodoro"><i class="fas fa-clock fa-lg"></i></a></li>
                <li><a href="#" class="sidebar-icon p-3 rounded-lg block text-center" data-target="gym"><i class="fas fa-dumbbell fa-lg"></i></a></li>
                <li><a href="#" class="sidebar-icon p-3 rounded-lg block text-center" data-target="basketball"><i class="fas fa-basketball-ball fa-lg"></i></a></li>
                <li><a href="#" class="sidebar-icon p-3 rounded-lg block text-center" data-target="planner"><i class="fas fa-calendar-alt fa-lg"></i></a></li>
            </ul>
        </div>
        <div><a href="#" class="sidebar-icon p-3 rounded-lg block text-center" data-target="settings"><i class="fas fa-cog fa-lg"></i></a></div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 p-6 sm:p-8 overflow-y-auto">
        
        <section id="dashboard" class="page">
            <h1 class="text-3xl font-bold mb-6">Dashboard</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Daily Goals</h2><p class="text-gray-400">Goal: <strong class="text-blue-400">2 lectures</strong> per day.</p><div class="mt-4"><p>Progress: <span id="dailyProgress">0</span> / 2</p><div class="w-full bg-gray-700 rounded-full h-2.5 mt-2"><div id="dailyProgressBar" class="bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div></div></div></div>
                <div class="bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Exam Countdown</h2><div id="examCountdownContainer"></div></div>
                <div class="bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Pomodoro Summary</h2><div class="flex justify-around text-center"><div><p class="text-2xl font-bold" id="pomodoroDaily">0h 0m</p><p class="text-gray-400">Today</p></div><div><p class="text-2xl font-bold" id="pomodoroWeekly">0h 0m</p><p class="text-gray-400">Week</p></div><div><p class="text-2xl font-bold" id="pomodoroMonthly">0h 0m</p><p class="text-gray-400">Month</p></div></div></div>
                <div class="bg-gray-800 p-6 rounded-lg md:col-span-2 h-96"><h2 class="text-xl font-semibold mb-4">Weekly Study Hours</h2><canvas id="weeklyStudyChart"></canvas></div>
                <div class="bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Weak Topics</h2><ul id="weakTopicsList" class="list-disc list-inside text-gray-400 space-y-2"></ul><button id="addMistakeBtn" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Log Mistake</button></div>
            </div>
        </section>

        <section id="schedule" class="page hidden">
            <div class="flex justify-between items-center mb-6"><h1 class="text-3xl font-bold">Today's Schedule</h1><button id="addCustomEventBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Add Event</button></div>
            <div class="bg-gray-800 p-6 rounded-lg"><div class="pl-12"><div id="timeline-container" class="timeline-container"></div></div></div>
        </section>

        <section id="subjects" class="page hidden">
            <h1 class="text-3xl font-bold mb-6">Subjects & Lectures</h1>
            <div class="mb-6"><input type="text" id="newSubjectInput" class="bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 w-full md:w-1/3" placeholder="New subject name..."><button id="addSubjectBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg ml-2">Add Subject</button></div>
            <div id="subjectsContainer" class="space-y-8"></div>
        </section>

        <section id="courses" class="page hidden">
            <h1 class="text-3xl font-bold mb-6">Course Planner</h1>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-gray-800 p-6 rounded-lg"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-semibold">Course Library</h2><button id="addCourseBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Add Course</button></div><div id="courseLibraryContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div></div>
                <div class="space-y-6">
                    <div class="bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Smart Scheduler</h2><div class="bg-gray-700 p-4 rounded-lg text-center"><i class="fas fa-lightbulb text-yellow-400 mb-2"></i><p>You have 45 free mins at 6 PM â€” do 1 AI course video.</p></div></div>
                    <div class="bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Notifications</h2><div id="course-notifications" class="space-y-2 text-sm"><p class="text-gray-400"><i class="fas fa-bell text-blue-400"></i> You havenâ€™t studied Radiology in 4 days.</p><p class="text-gray-400"><i class="fas fa-fire text-orange-500"></i> 5-day study streak! Keep it up!</p></div></div>
                    <div class="bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Goals & Milestones</h2><div id="course-goals-container"></div></div>
                </div>
            </div>
            <div class="mt-6 bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Weekly Course Planner</h2><div id="weekly-course-planner" class="grid grid-cols-7 gap-1 text-center text-xs"></div></div>
        </section>

        <section id="pomodoro" class="page hidden flex flex-col items-center justify-center h-full">
             <div class="text-center">
                <div class="pomodoro-dial mb-8" id="pomodoroDial"><div class="timer-display text-center"><div id="timer" class="text-6xl font-bold">25:00</div><div id="timer-status" class="text-lg text-gray-400">Stay Focused</div></div></div>
                <div class="mb-6"><select id="pomodoroSubjectAssign" class="bg-gray-700 border border-gray-600 rounded-lg py-2 px-4"></select></div>
                <div class="flex items-center justify-center space-x-8"><button id="resetTimerBtn" class="text-gray-400 hover:text-white text-2xl"><i class="fas fa-redo"></i></button><button id="startStopBtn" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full w-20 h-20 flex items-center justify-center text-3xl"><i class="fas fa-play"></i></button><button id="skipBtn" class="text-gray-400 hover:text-white text-2xl"><i class="fas fa-forward"></i></button></div>
                <div id="session-tracker" class="mt-6 text-lg">1 / 4 Sessions</div>
            </div>
        </section>
        
        <section id="gym" class="page hidden">
            <h1 class="text-3xl font-bold mb-6">Gym Tracker</h1>
            <div class="border-b border-gray-700 mb-6"><nav class="-mb-px flex space-x-8"><a href="#" class="tab-link gym-tab active" data-tab-target="gym-today">Today</a><a href="#" class="tab-link gym-tab" data-tab-target="gym-planner">Planner</a><a href="#" class="tab-link gym-tab" data-tab-target="gym-exercises">Library</a><a href="#" class="tab-link gym-tab" data-tab-target="gym-prs">PRs</a></nav></div>
            <div><div id="gym-today" class="tab-pane gym-pane"></div><div id="gym-planner" class="tab-pane gym-pane hidden"></div><div id="gym-exercises" class="tab-pane gym-pane hidden"></div><div id="gym-prs" class="tab-pane gym-pane hidden"></div></div>
        </section>

        <section id="basketball" class="page hidden">
            <h1 class="text-3xl font-bold mb-6">Basketball Analysis</h1>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-gray-800 p-4 rounded-lg">
                    <div class="bg-black rounded-lg mb-4 flex items-center justify-center h-96"><video id="basketball-video" class="w-full h-full rounded-lg" controls style="display: none;"></video><div id="video-placeholder" class="text-center text-gray-400"><i class="fas fa-video fa-3x mb-2"></i><p>Upload video</p></div></div>
                    <div class="flex items-center justify-between"><input type="file" id="video-upload" class="hidden" accept="video/*"><button id="import-video-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Import Video</button><button id="add-tag-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Tag Action</button></div>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg"><h2 class="text-xl font-semibold mb-4">Timeline</h2><div id="analysis-timeline" class="space-y-3 h-96 overflow-y-auto"></div></div>
            </div>
            <div class="mt-6">
                <div class="border-b border-gray-700"><nav class="-mb-px flex space-x-8"><a href="#" class="tab-link bball-tab active" data-tab-target="bball-stats">Stats</a><a href="#" class="tab-link bball-tab" data-tab-target="bball-shot-chart">Shot Chart</a><a href="#" class="tab-link bball-tab" data-tab-target="bball-lineups">Lineups</a><a href="#" class="tab-link bball-tab" data-tab-target="bball-report">Report</a></nav></div>
                <div class="mt-6">
                    <div id="bball-stats" class="tab-pane bball-pane"></div><div id="bball-shot-chart" class="tab-pane bball-pane hidden"></div><div id="bball-lineups" class="tab-pane bball-pane hidden"></div><div id="bball-report" class="tab-pane bball-pane hidden"></div>
                </div>
            </div>
        </section>

        <section id="planner" class="page hidden">
            <h1 class="text-3xl font-bold mb-6">Exam Planner</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Add Exam</h2><div class="space-y-4"><input type="text" id="examNameInput" class="bg-gray-700 w-full p-2 rounded" placeholder="Exam Name"><input type="date" id="examDateInput" class="bg-gray-700 w-full p-2 rounded"><button id="addExamBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Add Exam</button></div></div>
                <div class="bg-gray-800 p-6 rounded-lg"><h2 class="text-xl font-semibold mb-4">Reverse Study Schedule</h2><div id="reverseScheduleContainer" class="text-gray-400"></div></div>
            </div>
        </section>

        <section id="settings" class="page hidden">
            <h1 class="text-3xl font-bold mb-6">Settings</h1>
            <div class="bg-gray-800 p-6 rounded-lg max-w-md"><div class="flex items-center justify-between"><span class="text-lg">Dark Mode</span><label class="toggle-switch"><input type="checkbox" id="darkModeToggle" checked><span class="slider"></span></label></div></div>
        </section>

    </main>

    <!-- Modals -->
    <div id="flashcardModal" class="modal"></div><div id="mistakeModal" class="modal"></div><div id="exerciseModal" class="modal"></div><div id="taggingModal" class="modal"></div><div id="shotModal" class="modal"></div><div id="courseModal" class="modal"></div><div id="customEventModal" class="modal"></div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DATA STORE ---
            let db = {
                subjects: [{ id: 1, name: 'Pathology', lectures: [{ id: 1, uniLecs: 10, studied: 5, revised: false, totalTime: 3600 }, { id: 2, uniLecs: 1, studied: 1, revised: true, totalTime: 1500 }], videos: [{ id: 1, lectureId: 1, link: 'https://youtube.com/pathology-1' }], flashcards: [{lectureId: 1, front: 'What is necrosis?', back: 'Pathological cell death.'}] }],
                exams: [], mistakes: [], pomodoroLog: [],
                courses: [{ id: 1, title: 'AI for Everyone', platform: 'Coursera', category: 'AI', totalUnits: 4, completedUnits: 1, targetDate: '2025-09-30', sessionsPerWeek: 2, schedule: {'Monday': {start: '18:00', duration: 1}, 'Wednesday': {start: '19:00', duration: 1}} }, { id: 2, title: 'Advanced Anatomy', platform: 'Udemy', category: 'Med', totalUnits: 20, completedUnits: 15, targetDate: '2025-08-30', sessionsPerWeek: 3, schedule: {} }],
                gym: { exercises: [{ id: 1, name: 'Bench Press', group: 'Chest', cues: 'Retract shoulders', tags: ['compound'], history: [{date: '2023-10-17', weight: 60, reps: 10}] }], planner: { 'Monday': { name: 'Push Day', exercises: [1], start: '17:00', duration: 1}, 'Tuesday': { name: 'Leg Day', exercises: [], start: '17:00', duration: 1.5 }, 'Wednesday': { name: 'Pull Day', exercises: [], start: '17:00', duration: 1 }, 'Thursday': { name: 'Rest', exercises: [] }, 'Friday': { name: 'Full Body', exercises: [1], start: '17:00', duration: 2 }, 'Saturday': { name: 'Rest', exercises: [] }, 'Sunday': { name: 'Rest', exercises: [] } }, prs: [ { exerciseId: 1, weight: 80, reps: 5, date: '2023-10-17'} ] },
                basketball: { players: [ { id: 1, name: 'Player 1' }, { id: 2, name: 'Player 2' }, { id: 3, name: 'Player 3' } ], tags: [], shots: [], lineups: [ { players: [1,2,3], plusMinus: 5 } ] },
                schedule: { sleep: { start: '23:00', end: '07:00'}, customEvents: [{ id: 1, title: 'Lunch', date: '2025-08-07', start: '13:00', end: '14:30', color: 'purple' }] }
            };

            // --- STATE & UI SELECTORS ---
            let timerInterval, weeklyChart, currentMode = 'pomodoro', timeLeft = 1500, isRunning = false, sessionCount = 1, tempShotData = {}, currentFlashcardState = {};
            const pages = document.querySelectorAll('.page');
            const navLinks = document.querySelectorAll('.sidebar-icon');
            const darkModeToggle = document.getElementById('darkModeToggle');

            // --- CORE APP LOGIC ---
            function setupNavigation() { navLinks.forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); const targetId = link.dataset.target; pages.forEach(page => page.classList.add('hidden')); document.getElementById(targetId).classList.remove('hidden'); navLinks.forEach(nav => nav.classList.remove('active')); link.classList.add('active'); }); }); }
            function setupTabNavigation(tabSelector, paneSelector) { const tabs = document.querySelectorAll(tabSelector); tabs.forEach(tab => { tab.addEventListener('click', e => { e.preventDefault(); const targetId = tab.dataset.tabTarget; document.querySelectorAll(paneSelector).forEach(pane => pane.classList.add('hidden')); document.getElementById(targetId).classList.remove('hidden'); tabs.forEach(t => t.classList.remove('active')); tab.classList.add('active'); }); }); }
            darkModeToggle.addEventListener('change', () => { document.documentElement.classList.toggle('dark'); renderAll(); });

            // --- EVENT DELEGATION ---
            document.body.addEventListener('click', handleGlobalClick);
            document.body.addEventListener('change', handleGlobalChange);

            function handleGlobalClick(e) {
                const target = e.target;
                const id = target.id;
                const classList = target.classList;
                if (classList.contains('modal') || target.closest('.close-modal')) { target.closest('.modal').style.display = 'none'; return; }
                const actions = {
                    'addCustomEventBtn': openCustomEventModal, 'saveCustomEventBtn': saveCustomEvent, 'addSubjectBtn': addSubject, 'addExamBtn': addExam, 'addMistakeBtn': openMistakeModal, 'saveMistakeBtn': saveMistake,
                    'addCourseBtn': openCourseModal, 'saveCourseBtn': saveCourse, 'addExerciseBtn': openExerciseModal, 'saveExerciseBtn': saveExercise, 'import-video-btn': () => document.getElementById('video-upload').click(),
                    'add-tag-btn': openTaggingModal, 'saveTagBtn': saveTag, 'shot-made-btn': () => logShot(true), 'shot-missed-btn': () => logShot(false), 'download-report-btn': downloadReport,
                    'flipFlashcard': () => document.querySelector('.flashcard').classList.toggle('is-flipped'), 'prevFlashcard': () => navigateFlashcard(-1), 'nextFlashcard': () => navigateFlashcard(1), 'addFlashcardBtn': addFlashcard
                };
                if (actions[id]) actions[id]();
                if (classList.contains('add-lecture')) addLecture(target);
                if (target.closest('.add-video')) addVideo(target);
                if (target.closest('.remove-video')) removeVideo(target);
                if (target.closest('.open-flashcards')) openFlashcardModal(target);
                if (target.closest('.edit-exercise-btn')) openExerciseModal(target.closest('.edit-exercise-btn'));
                if (id === 'shot-chart-container') handleShotChartClick(e);
            }

            function handleGlobalChange(e) {
                const target = e.target;
                if (target.closest('.lecture-table-input')) updateLecture(target);
                if (target.id === 'video-upload') importVideo(target);
            }

            // --- MASTER RENDER FUNCTION ---
            function renderAll() {
                renderDashboardMetrics(); renderWeeklyChart(); renderSubjects(); renderPomodoroAssignments(); renderMistakeLog(); renderExams(); updateTimerDisplay(); renderCourses(); renderSchedule();
                renderGymPlanner(); renderTodaysWorkout(); renderExerciseLibrary(); renderPrLog(); renderBasketball();
            }

            // --- POMODORO ---
            const modes = { pomodoro: { time: 1500, status: 'Stay Focused' }, shortBreak: { time: 300, status: 'Short Break' }, longBreak: { time: 900, status: 'Long Break' } };
            function updateTimerDisplay() { const timerDisplay = document.getElementById('timer'); if (!timerDisplay) return; const minutes = Math.floor(timeLeft / 60); const seconds = timeLeft % 60; timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; const totalSeconds = modes[currentMode].time; const percentage = ((totalSeconds - timeLeft) / totalSeconds) * 360; document.getElementById('pomodoroDial').style.background = `conic-gradient(#38bdf8 ${percentage}deg, #2d3748 ${percentage}deg)`; }
            function startTimer() { if (isRunning) return; isRunning = true; document.getElementById('startStopBtn').innerHTML = '<i class="fas fa-pause"></i>'; timerInterval = setInterval(() => { timeLeft--; updateTimerDisplay(); if (timeLeft <= 0) { clearInterval(timerInterval); logPomodoroSession(); switchMode(); } }, 1000); }
            function stopTimer() { if (!isRunning) return; isRunning = false; document.getElementById('startStopBtn').innerHTML = '<i class="fas fa-play"></i>'; clearInterval(timerInterval); }
            function resetTimer() { stopTimer(); timeLeft = modes[currentMode].time; updateTimerDisplay(); }
            function switchMode(forceNext = false) { stopTimer(); if (currentMode === 'pomodoro') { if (!forceNext) sessionCount++; currentMode = sessionCount % 4 === 0 ? 'longBreak' : 'shortBreak'; } else { currentMode = 'pomodoro'; } timeLeft = modes[currentMode].time; document.getElementById('timer-status').textContent = modes[currentMode].status; document.getElementById('session-tracker').textContent = `${Math.ceil(sessionCount/2)} / 4 Sessions`; updateTimerDisplay(); }
            function logPomodoroSession() { if (currentMode !== 'pomodoro') return; const duration = modes.pomodoro.time; const assigned = document.getElementById('pomodoroSubjectAssign').value; let [subjectId, lectureId] = assigned ? assigned.split('-').map(Number) : [null, null]; if (subjectId && lectureId) { const subject = db.subjects.find(s => s.id === subjectId); const lecture = subject?.lectures.find(l => l.id === lectureId); if (lecture) lecture.totalTime = (lecture.totalTime || 0) + duration; } db.pomodoroLog.push({ date: new Date().toISOString(), duration, subjectId, lectureId }); renderDashboardMetrics(); }
            document.getElementById('startStopBtn').addEventListener('click', () => isRunning ? stopTimer() : startTimer());
            document.getElementById('resetTimerBtn').addEventListener('click', resetTimer);
            document.getElementById('skipBtn').addEventListener('click', () => switchMode(true));

            // --- RENDER FUNCTIONS ---
            function renderDashboardMetrics() { document.getElementById('dailyProgress').textContent = `0`; document.getElementById('dailyProgressBar').style.width = `0%`; const now = new Date(); const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); const startOfWeek = new Date(today); startOfWeek.setDate(today.getDate() - today.getDay()); const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1); const dailyTotal = db.pomodoroLog.filter(p => new Date(p.date) >= today).reduce((sum, p) => sum + p.duration, 0); const weeklyTotal = db.pomodoroLog.filter(p => new Date(p.date) >= startOfWeek).reduce((sum, p) => sum + p.duration, 0); const monthlyTotal = db.pomodoroLog.filter(p => new Date(p.date) >= startOfMonth).reduce((sum, p) => sum + p.duration, 0); document.getElementById('pomodoroDaily').textContent = formatTime(dailyTotal, true); document.getElementById('pomodoroWeekly').textContent = formatTime(weeklyTotal, true); document.getElementById('pomodoroMonthly').textContent = formatTime(monthlyTotal, true); }
            function renderWeeklyChart() { const ctx = document.getElementById('weeklyStudyChart').getContext('2d'); const isDark = document.documentElement.classList.contains('dark'); const gridColor = isDark ? '#4a5568' : '#e2e8f0'; const textColor = isDark ? '#a0aec0' : '#4a5568'; const data = { labels: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'], datasets: db.subjects.map((subject, index) => ({ label: subject.name, data: Array(7).fill(0).map(() => Math.random() * 5), backgroundColor: ['#38bdf8', '#6366f1', '#ec4899'][index % 3], borderRadius: 5 })) }; if (weeklyChart) weeklyChart.destroy(); weeklyChart = new Chart(ctx, { type: 'bar', data: data, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours Studied', color: textColor }, grid: { color: gridColor }, ticks: { color: textColor } }, x: { grid: { display: false }, ticks: { color: textColor } } }, plugins: { legend: { labels: { color: textColor } } } } }); }
            function renderExams() { const container = document.getElementById('examCountdownContainer'); container.innerHTML = ''; if (db.exams.length === 0) { container.innerHTML = '<p class="text-gray-400">No upcoming exams.</p>'; document.getElementById('reverseScheduleContainer').innerHTML = '<p class="text-gray-400">Add an exam to generate a schedule.</p>'; return; } db.exams.sort((a, b) => new Date(a.date) - new Date(b.date)); db.exams.forEach(exam => { const diffDays = Math.ceil((new Date(exam.date) - new Date()) / (1000 * 60 * 60 * 24)); container.innerHTML += `<div class="mb-2"><p><strong>${exam.name}</strong> is in <span class="text-blue-400 font-bold">${diffDays} days</span></p></div>`; }); generateReverseSchedule(); }
            function generateReverseSchedule() { const container = document.getElementById('reverseScheduleContainer'); const upcomingExam = db.exams[0]; if (!upcomingExam) return; const daysUntilExam = Math.ceil((new Date(upcomingExam.date) - new Date()) / (1000 * 60 * 60 * 24)); const totalLecturesToStudy = db.subjects.reduce((sum, s) => sum + s.lectures.reduce((lecSum, l) => lecSum + (l.uniLecs - l.studied), 0), 0); const lecturesPerDay = totalLecturesToStudy > 0 && daysUntilExam > 3 ? (totalLecturesToStudy / (daysUntilExam - 3)).toFixed(1) : 0; container.innerHTML = `<h3 class="font-semibold text-lg">${upcomingExam.name} Plan</h3><p>Study <strong class="text-blue-400">${lecturesPerDay} lectures per day</strong>.</p>`; }
            function addExam() { const nameInput = document.getElementById('examNameInput'); const dateInput = document.getElementById('examDateInput'); if (nameInput.value && dateInput.value) { db.exams.push({ id: Date.now(), name: nameInput.value, date: dateInput.value }); nameInput.value = ''; dateInput.value = ''; renderAll(); } }
            function renderMistakeLog() { document.getElementById('weakTopicsList').innerHTML = db.mistakes.length === 0 ? '<li>No mistakes logged.</li>' : db.mistakes.map(m => `<li>${m.topic} (${db.subjects.find(s => s.id === m.subjectId)?.name})</li>`).join(''); }
            function openMistakeModal() { let selectHTML = '<option value="">Select Subject</option>'; db.subjects.forEach(s => selectHTML += `<option value="${s.id}">${s.name}</option>`); document.getElementById('mistakeModal').innerHTML = `<div class="modal-content"><span class="close-modal absolute top-4 right-6 text-2xl font-bold cursor-pointer">&times;</span><h2 class="text-xl font-bold mb-4">Log Mistake</h2><div class="space-y-4"><input type="text" id="mistakeTopicInput" placeholder="Topic" class="bg-gray-700 w-full p-2 rounded"><textarea id="mistakeDescriptionInput" placeholder="Description" class="bg-gray-700 w-full p-2 rounded h-24"></textarea><select id="mistakeSubjectSelect" class="bg-gray-700 w-full p-2 rounded">${selectHTML}</select><button id="saveMistakeBtn" class="w-full bg-blue-600 p-2 rounded">Save</button></div></div>`; document.getElementById('mistakeModal').style.display = 'block'; }
            function saveMistake() { const topic = document.getElementById('mistakeTopicInput').value.trim(); const description = document.getElementById('mistakeDescriptionInput').value.trim(); const subjectId = parseInt(document.getElementById('mistakeSubjectSelect').value); if (topic && description && subjectId) { db.mistakes.push({ id: Date.now(), topic, description, subjectId }); document.getElementById('mistakeModal').style.display = 'none'; renderAll(); } }
            function renderSubjects() { const container = document.getElementById('subjectsContainer'); container.innerHTML = ''; db.subjects.forEach(s => { const el = document.createElement('div'); el.className = 'bg-gray-800 p-6 rounded-lg'; el.innerHTML = `<h2 class="text-xl font-semibold mb-4">${s.name}</h2><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr><th>Lec#</th><th>Univ.</th><th>Studied</th><th>Status</th><th>Actions</th></tr></thead><tbody>${s.lectures.map(l => `<tr><td>${l.id}</td><td><input type="number" value="${l.uniLecs}" class="w-16 bg-gray-700 p-1 rounded lecture-table-input" data-type="uniLecs" data-subject-id="${s.id}" data-lecture-id="${l.id}"></td><td><input type="number" value="${l.studied}" class="w-16 bg-gray-700 p-1 rounded lecture-table-input" data-type="studied" data-subject-id="${s.id}" data-lecture-id="${l.id}"></td><td><label class="toggle-switch"><input type="checkbox" ${l.revised ? 'checked' : ''} class="lecture-table-input" data-type="revised" data-subject-id="${s.id}" data-lecture-id="${l.id}"><span class="slider"></span></label></td><td><button class="text-blue-400 open-flashcards" data-subject-id="${s.id}" data-lecture-id="${l.id}"><i class="fas fa-clone"></i></button></td></tr>`).join('')}</tbody></table></div><button class="mt-4 text-sm text-blue-400 add-lecture" data-subject-id="${s.id}">+ Add Lecture</button>`; container.appendChild(el); }); }
            function addSubject() { const input = document.getElementById('newSubjectInput'); if (input.value.trim()) { db.subjects.push({ id: Date.now(), name: input.value.trim(), lectures: [], videos: [], flashcards: [] }); input.value = ''; renderAll(); } }
            function addLecture(target) { const subjectId = parseInt(target.dataset.subjectId); const subject = db.subjects.find(s => s.id === subjectId); if (subject) { const newId = subject.lectures.length > 0 ? Math.max(...subject.lectures.map(l => l.id)) + 1 : 1; subject.lectures.push({ id: newId, uniLecs: 1, studied: 0, revised: false, totalTime: 0 }); renderAll(); } }
            function updateLecture(target) { const { subjectId, lectureId, type } = target.dataset; const subject = db.subjects.find(s => s.id === parseInt(subjectId)); const lecture = subject?.lectures.find(l => l.id === parseInt(lectureId)); if (lecture) { lecture[type] = target.type === 'checkbox' ? target.checked : parseInt(target.value); renderAll(); } }
            function openFlashcardModal(target) { const subjectId = parseInt(target.closest('[data-subject-id]').dataset.subjectId); const lectureId = parseInt(target.closest('[data-lecture-id]').dataset.lectureId); const subject = db.subjects.find(s => s.id === subjectId); const lecture = subject?.lectures.find(l => l.id === lectureId); if (!subject || !lecture) return; currentFlashcardState = { subjectId, lectureId, cards: subject.flashcards.filter(f => f.lectureId === lectureId), currentIndex: 0 }; document.getElementById('flashcardModal').innerHTML = `<div class="modal-content"><span class="close-modal absolute top-4 right-6 text-2xl font-bold cursor-pointer">&times;</span><h2 class="text-xl font-bold mb-4">Flashcards for ${subject.name} - Lec ${lecture.id}</h2><div class="mb-4"><div class="flashcard"><div class="flashcard-inner"><div class="flashcard-front"><p id="flashcard-front-content"></p></div><div class="flashcard-back"><p id="flashcard-back-content"></p></div></div></div></div><div class="flex justify-between items-center mb-4"><button id="prevFlashcard" class="bg-gray-600 p-2 rounded"><i class="fas fa-arrow-left"></i></button><span id="flashcardCounter"></span><button id="nextFlashcard" class="bg-gray-600 p-2 rounded"><i class="fas fa-arrow-right"></i></button></div><button id="flipFlashcard" class="w-full bg-blue-600 p-2 rounded mb-4">Flip</button><div class="flex gap-4"><input type="text" id="newFlashcardFront" placeholder="Front" class="bg-gray-700 w-1/2 p-2 rounded"><input type="text" id="newFlashcardBack" placeholder="Back" class="bg-gray-700 w-1/2 p-2 rounded"></div><button id="addFlashcardBtn" class="w-full mt-4 bg-green-600 p-2 rounded">Add Card</button></div>`; renderFlashcard(); document.getElementById('flashcardModal').style.display = 'block'; }
            function renderFlashcard() { const { cards, currentIndex } = currentFlashcardState; const modal = document.getElementById('flashcardModal'); modal.querySelector('.flashcard').classList.remove('is-flipped'); if (cards.length === 0) { modal.querySelector('#flashcard-front-content').textContent = 'No cards yet.'; modal.querySelector('#flashcard-back-content').textContent = 'Add one!'; modal.querySelector('#flashcardCounter').textContent = '0 / 0'; } else { const card = cards[currentIndex]; modal.querySelector('#flashcard-front-content').textContent = card.front; modal.querySelector('#flashcard-back-content').textContent = card.back; modal.querySelector('#flashcardCounter').textContent = `${currentIndex + 1} / ${cards.length}`; } }
            function navigateFlashcard(direction) { const { cards } = currentFlashcardState; if (cards.length > 0) { currentFlashcardState.currentIndex = (currentFlashcardState.currentIndex + direction + cards.length) % cards.length; renderFlashcard(); } }
            function addFlashcard() { const modal = document.getElementById('flashcardModal'); const front = modal.querySelector('#newFlashcardFront').value.trim(); const back = modal.querySelector('#newFlashcardBack').value.trim(); const { subjectId, lectureId } = currentFlashcardState; if (front && back) { const subject = db.subjects.find(s => s.id === subjectId); subject.flashcards.push({ lectureId, front, back }); openFlashcardModal(modal.querySelector('.open-flashcards')); } }
            function renderPomodoroAssignments() { const select = document.getElementById('pomodoroSubjectAssign'); select.innerHTML = '<option value="">Assign to lecture...</option>'; db.subjects.forEach(s => { const optgroup = document.createElement('optgroup'); optgroup.label = s.name; s.lectures.forEach(l => { optgroup.innerHTML += `<option value="${s.id}-${l.id}">Lecture ${l.id}</option>`; }); select.appendChild(optgroup); }); }
            function renderCourses() { renderCourseLibrary(); renderCoursePlanner(); renderCourseGoals(); }
            function renderCourseLibrary() { const container = document.getElementById('courseLibraryContainer'); container.innerHTML = ''; if (db.courses.length === 0) { container.innerHTML = '<p class="text-gray-400 md:col-span-2">No courses added.</p>'; return; } db.courses.forEach(c => { const progress = (c.completedUnits / c.totalUnits) * 100; container.innerHTML += `<div class="bg-gray-700 p-4 rounded-lg"><h3 class="font-bold">${c.title}</h3><p class="text-sm text-gray-400">${c.platform} - ${c.category}</p><div class="mt-3"><div class="flex justify-between text-sm mb-1"><span>Progress</span><span>${Math.round(progress)}%</span></div><div class="w-full bg-gray-600 rounded-full h-2.5"><div class="bg-blue-500 h-2.5 rounded-full" style="width: ${progress}%"></div></div><p class="text-xs text-gray-500 mt-1">${c.completedUnits}/${c.totalUnits} units</p></div></div>`; }); }
            function renderCoursePlanner() { const container = document.getElementById('weekly-course-planner'); container.innerHTML = ''; const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']; days.forEach(day => container.innerHTML += `<div class="font-bold border-b border-gray-700 pb-1">${day.substring(0,3)}</div>`); days.forEach(day => { let cellHTML = '<div class="bg-gray-900 rounded planner-cell p-1 space-y-1">'; db.courses.forEach(c => { if (c.schedule[day]) { cellHTML += `<div class="bg-green-800 p-1 rounded">${c.title} (${c.schedule[day].duration}h)</div>`; } }); cellHTML += '</div>'; container.innerHTML += cellHTML; }); }
            function renderCourseGoals() { const container = document.getElementById('course-goals-container'); container.innerHTML = ''; db.courses.slice(0, 2).forEach(c => { const sessionsDone = Object.values(c.schedule).length; container.innerHTML += `<div class="mb-3"><p class="font-semibold text-sm">${c.title}</p><p class="text-xs text-gray-400">Goal: ${c.sessionsPerWeek} sessions/week. You've done ${sessionsDone}.</p></div>`; }); }
            function openCourseModal(target) { const courseId = target ? parseInt(target.dataset.courseId) : null; const course = courseId ? db.courses.find(c => c.id === courseId) : null; document.getElementById('courseModal').innerHTML = `<div class="modal-content"><span class="close-modal absolute top-4 right-6 text-2xl font-bold cursor-pointer">&times;</span><h2 class="text-xl font-bold mb-4">${course ? 'Edit' : 'Add'} Course</h2><div class="space-y-4"><input type="hidden" id="courseIdInput" value="${course?.id || ''}"><input type="text" id="courseTitleInput" placeholder="Title" class="bg-gray-700 w-full p-2 rounded" value="${course?.title || ''}"><div class="grid grid-cols-2 gap-4"><input type="text" id="coursePlatformInput" placeholder="Platform" class="bg-gray-700 w-full p-2 rounded" value="${course?.platform || ''}"><input type="text" id="courseCategoryInput" placeholder="Category" class="bg-gray-700 w-full p-2 rounded" value="${course?.category || ''}"></div><div class="grid grid-cols-2 gap-4"><input type="number" id="courseTotalUnitsInput" placeholder="Total Units" class="bg-gray-700 w-full p-2 rounded" value="${course?.totalUnits || ''}"><input type="number" id="courseCompletedUnitsInput" placeholder="Completed Units" class="bg-gray-700 w-full p-2 rounded" value="${course?.completedUnits || ''}"></div><div><label class="text-sm">Target Date</label><input type="date" id="courseTargetDateInput" class="bg-gray-700 w-full p-2 rounded" value="${course?.targetDate || ''}"></div><input type="number" id="courseSessionsWeekInput" placeholder="Target Sessions/Week" class="bg-gray-700 w-full p-2 rounded" value="${course?.sessionsPerWeek || ''}"><button id="saveCourseBtn" class="w-full bg-blue-600 p-2 rounded">Save</button></div></div>`; document.getElementById('courseModal').style.display = 'block'; }
            function saveCourse() { const modal = document.getElementById('courseModal'); const id = parseInt(modal.querySelector('#courseIdInput').value); const data = { title: modal.querySelector('#courseTitleInput').value, platform: modal.querySelector('#coursePlatformInput').value, category: modal.querySelector('#courseCategoryInput').value, totalUnits: parseInt(modal.querySelector('#courseTotalUnitsInput').value), completedUnits: parseInt(modal.querySelector('#courseCompletedUnitsInput').value), targetDate: modal.querySelector('#courseTargetDateInput').value, sessionsPerWeek: parseInt(modal.querySelector('#courseSessionsWeekInput').value) }; if (id) { const index = db.courses.findIndex(c => c.id === id); db.courses[index] = { ...db.courses[index], ...data }; } else { db.courses.push({ id: Date.now(), ...data, schedule: {} }); } modal.style.display = 'none'; renderAll(); }
            function renderSchedule() { const container = document.getElementById('timeline-container'); if (!container) return; container.innerHTML = ''; for (let i = 0; i < 24; i++) { container.innerHTML += `<div class="timeline-hour"><span class="timeline-hour-label">${i.toString().padStart(2, '0')}:00</span></div>`; } const today = new Date(); const dayOfWeek = today.toLocaleString('en-us', { weekday: 'long' }); const events = []; const sleepStart = timeToMinutes(db.schedule.sleep.start); const sleepEnd = timeToMinutes(db.schedule.sleep.end); events.push({ title: 'Sleep', start: 0, duration: sleepEnd, color: 'indigo' }); events.push({ title: 'Sleep', start: sleepStart, duration: 1440 - sleepStart, color: 'indigo' }); const gymWorkout = db.gym.planner[dayOfWeek]; if (gymWorkout && gymWorkout.exercises.length > 0) { events.push({ title: `Gym: ${gymWorkout.name}`, start: timeToMinutes(gymWorkout.start), duration: gymWorkout.duration * 60, color: 'red' }); } db.courses.forEach(c => { const session = c.schedule[dayOfWeek]; if (session) { events.push({ title: `Course: ${c.title}`, start: timeToMinutes(session.start), duration: session.duration * 60, color: 'green' }); } }); db.schedule.customEvents.forEach(e => { events.push({ title: e.title, start: timeToMinutes(e.start), duration: timeToMinutes(e.end) - timeToMinutes(e.start), color: e.color }); }); events.forEach(e => { container.innerHTML += `<div class="timeline-event" style="top:${e.start}px; height:${e.duration}px; background-color:rgba(${getColor(e.color)}, 0.5); border-color:rgb(${getColor(e.color)});"><p class="font-bold">${e.title}</p></div>`; }); }
            function openCustomEventModal() { document.getElementById('customEventModal').innerHTML = `<div class="modal-content"><span class="close-modal absolute top-4 right-6 text-2xl font-bold cursor-pointer">&times;</span><h2 class="text-xl font-bold mb-4">Add Custom Event</h2><div class="space-y-4"><input type="text" id="customEventTitle" placeholder="Title" class="bg-gray-700 w-full p-2 rounded"><div class="grid grid-cols-2 gap-4"><div><label class="text-sm">Start</label><input type="time" id="customEventStart" class="bg-gray-700 w-full p-2 rounded"></div><div><label class="text-sm">End</label><input type="time" id="customEventEnd" class="bg-gray-700 w-full p-2 rounded"></div></div><div><label class="text-sm">Color</label><select id="customEventColor" class="bg-gray-700 w-full p-2 rounded"><option value="purple">Purple</option><option value="yellow">Yellow</option><option value="teal">Teal</option></select></div><button id="saveCustomEventBtn" class="w-full bg-blue-600 p-2 rounded">Save</button></div></div>`; document.getElementById('customEventModal').style.display = 'block'; }
            function saveCustomEvent() { const modal = document.getElementById('customEventModal'); const title = modal.querySelector('#customEventTitle').value; const start = modal.querySelector('#customEventStart').value; const end = modal.querySelector('#customEventEnd').value; const color = modal.querySelector('#customEventColor').value; if (title && start && end) { db.schedule.customEvents.push({ id: Date.now(), title, start, end, color, date: new Date().toISOString().split('T')[0] }); modal.style.display = 'none'; renderSchedule(); } }
            function renderGymPlanner() { const container = document.getElementById('gym-planner'); container.innerHTML = `<h2 class="text-2xl font-semibold mb-4">Weekly Planner</h2><div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>`; const plannerContainer = container.querySelector('div.grid'); Object.entries(db.gym.planner).forEach(([day, plan]) => { plannerContainer.innerHTML += `<div class="bg-gray-800 p-4 rounded-lg"><h3 class="font-bold text-lg">${day}</h3><p class="text-blue-400">${plan.name}</p><ul class="text-sm text-gray-400 mt-2 list-disc list-inside">${plan.exercises.map(exId => `<li>${db.gym.exercises.find(e => e.id === exId)?.name || ''}</li>`).join('')}</ul></div>`; }); }
            function renderTodaysWorkout() { const container = document.getElementById('gym-today'); const today = new Date().toLocaleString('en-us', { weekday: 'long' }); const workout = db.gym.planner[today]; container.innerHTML = `<h2 class="text-2xl font-semibold mb-4">Today: ${workout.name}</h2>`; if (!workout || workout.exercises.length === 0) { container.innerHTML += '<p class="text-gray-400">Rest day!</p>'; return; } const workoutTable = document.createElement('div'); workoutTable.className = 'space-y-6'; workout.exercises.forEach(exId => { const ex = db.gym.exercises.find(e => e.id === exId); if (!ex) return; const lastSession = ex.history[ex.history.length - 1]; const historyText = lastSession ? `Last: ${lastSession.weight}kg x ${lastSession.reps} reps` : 'First time!'; let setsHtml = ''; for (let i = 1; i <= 3; i++) { setsHtml += `<tr><td class="p-2">${i}</td><td class="p-2"><input type="number" class="w-20 bg-gray-700 p-1 rounded" placeholder="${lastSession ? lastSession.weight : ''}"></td><td class="p-2"><input type="number" class="w-20 bg-gray-700 p-1 rounded" placeholder="${lastSession ? lastSession.reps : ''}"></td><td class="p-2"><input type="checkbox" class="w-5 h-5 bg-gray-700 rounded text-blue-500 focus:ring-blue-600"></td></tr>`; } workoutTable.innerHTML += `<div class="bg-gray-800 p-4 rounded-lg"><h3 class="text-xl font-bold">${ex.name}</h3><p class="text-sm text-gray-400 mb-3"><i class="fas fa-history"></i> ${historyText}</p><table class="w-full text-center"><thead><tr><th>Set</th><th>Weight (kg)</th><th>Reps</th><th>Done</th></tr></thead><tbody>${setsHtml}</tbody></table></div>`; }); container.appendChild(workoutTable); }
            function renderExerciseLibrary() { const container = document.getElementById('gym-exercises'); container.innerHTML = `<h2 class="text-2xl font-semibold mb-4">Exercise Library</h2><button id="addExerciseBtn" class="mb-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Add Exercise</button><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>`; const libraryContainer = container.querySelector('div.grid'); db.gym.exercises.forEach(ex => { libraryContainer.innerHTML += `<div class="bg-gray-800 p-4 rounded-lg flex flex-col justify-between"><div><h3 class="font-bold text-lg">${ex.name}</h3><p class="text-sm text-blue-400">${ex.group}</p><div class="mt-2 space-x-2">${ex.tags.map(tag => `<span class="bg-gray-700 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">${tag}</span>`).join('')}</div><p class="text-sm text-gray-400 mt-2">${ex.cues}</p></div><div class="mt-4"><button class="edit-exercise-btn text-sm text-yellow-400 hover:underline" data-exercise-id="${ex.id}">Edit</button></div></div>`; }); }
            function renderPrLog() { const container = document.getElementById('gym-prs'); container.innerHTML = `<h2 class="text-2xl font-semibold mb-4">Personal Records</h2><div class="space-y-4"></div>`; const prContainer = container.querySelector('div.space-y-4'); if (db.gym.prs.length === 0) { prContainer.innerHTML = '<p class="text-gray-400">No PRs logged yet!</p>'; return; } db.gym.prs.forEach(pr => { const ex = db.gym.exercises.find(e => e.id === pr.exerciseId); prContainer.innerHTML += `<div class="bg-gray-800 p-4 rounded-lg flex items-center justify-between"><div><p class="font-bold text-xl">${ex?.name}</p><p class="text-gray-400 text-sm">${new Date(pr.date).toLocaleDateString()}</p></div><div class="text-right"><p class="text-2xl font-bold text-blue-400">${pr.weight}kg x ${pr.reps}</p><p class="text-sm text-gray-500">Est. 1RM: ${Math.round(pr.weight * (1 + pr.reps / 30))}kg</p></div><div class="text-yellow-400 text-3xl"><i class="fas fa-trophy"></i></div></div>`; }); }
            function openExerciseModal(target) { const exId = target ? parseInt(target.dataset.exerciseId) : null; const ex = exId ? db.gym.exercises.find(e => e.id === exId) : null; document.getElementById('exerciseModal').innerHTML = `<div class="modal-content"><span class="close-modal absolute top-4 right-6 text-2xl font-bold cursor-pointer">&times;</span><h2 class="text-xl font-bold mb-4">${ex ? 'Edit' : 'Add'} Exercise</h2><div class="space-y-4"><input type="hidden" id="exerciseIdInput" value="${ex?.id || ''}"><input type="text" id="exerciseNameInput" placeholder="Name" class="bg-gray-700 w-full p-2 rounded" value="${ex?.name || ''}"><select id="exerciseGroupInput" class="bg-gray-700 w-full p-2 rounded">${['Chest','Back','Shoulders','Biceps','Triceps','Legs','Abs','Other'].map(g => `<option ${ex?.group === g ? 'selected' : ''}>${g}</option>`).join('')}</select><input type="text" id="exerciseCuesInput" placeholder="Cues" class="bg-gray-700 w-full p-2 rounded" value="${ex?.cues || ''}"><input type="text" id="exerciseTagsInput" placeholder="Tags (comma-separated)" class="bg-gray-700 w-full p-2 rounded" value="${ex?.tags.join(', ') || ''}"><button id="saveExerciseBtn" class="w-full bg-blue-600 p-2 rounded">Save</button></div></div>`; document.getElementById('exerciseModal').style.display = 'block'; }
            function saveExercise() { const modal = document.getElementById('exerciseModal'); const id = parseInt(modal.querySelector('#exerciseIdInput').value); const data = { name: modal.querySelector('#exerciseNameInput').value, group: modal.querySelector('#exerciseGroupInput').value, cues: modal.querySelector('#exerciseCuesInput').value, tags: modal.querySelector('#exerciseTagsInput').value.split(',').map(t => t.trim()).filter(Boolean) }; if (id) { const index = db.gym.exercises.findIndex(e => e.id === id); db.gym.exercises[index] = { ...db.gym.exercises[index], ...data }; } else { db.gym.exercises.push({ id: Date.now(), ...data, history: [] }); } modal.style.display = 'none'; renderAll(); }
            function renderBasketball() { renderTimeline(); renderShotChart(); renderPlayerStats(); renderLineupImpact(); renderGameReport(); }
            function importVideo(target) { const file = target.files[0]; const videoPlayer = document.getElementById('basketball-video'); if (file) { videoPlayer.src = URL.createObjectURL(file); videoPlayer.style.display = 'block'; document.getElementById('video-placeholder').style.display = 'none'; } }
            function openTaggingModal() { const videoPlayer = document.getElementById('basketball-video'); if (!videoPlayer.src) { alert("Import a video first."); return; } document.getElementById('taggingModal').innerHTML = `<div class="modal-content"><span class="close-modal absolute top-4 right-6 text-2xl font-bold cursor-pointer">&times;</span><h2 class="text-xl font-bold mb-4">Tag Action</h2><div class="space-y-4"><div><label>Player</label><select id="tag-player" class="bg-gray-700 w-full p-2 rounded">${db.basketball.players.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}</select></div><div><label>Category</label><select id="tag-category" class="bg-gray-700 w-full p-2 rounded">${['Offense','Defense','Transition'].map(c => `<option>${c}</option>`).join('')}</select></div><div><label>Action</label><input type="text" id="tag-action" placeholder="e.g., Pick & Roll" class="bg-gray-700 w-full p-2 rounded"></div><div><label>Stat Type</label><select id="tag-stat-type" class="bg-gray-700 w-full p-2 rounded">${Object.entries({'none':'None','fga_made':'Shot Made','fga_missed':'Shot Missed','ast':'Assist'}).map(([v,l]) => `<option value="${v}">${l}</option>`).join('')}</select></div><button id="saveTagBtn" class="w-full bg-blue-600 p-2 rounded">Save</button></div></div>`; document.getElementById('taggingModal').style.display = 'block'; }
            function saveTag() { const modal = document.getElementById('taggingModal'); db.basketball.tags.push({ id: Date.now(), time: document.getElementById('basketball-video').currentTime, timeFormatted: formatVideoTime(document.getElementById('basketball-video').currentTime), playerId: parseInt(modal.querySelector('#tag-player').value), category: modal.querySelector('#tag-category').value, action: modal.querySelector('#tag-action').value, statType: modal.querySelector('#tag-stat-type').value }); modal.style.display = 'none'; renderBasketball(); }
            function handleShotChartClick(e) { const rect = e.currentTarget.getBoundingClientRect(); tempShotData = { x: (e.clientX - rect.left) / rect.width * 100, y: (e.clientY - rect.top) / rect.height * 100 }; document.getElementById('shotModal').innerHTML = `<div class="modal-content max-w-xs"><h2 class="text-xl font-bold mb-4 text-center">Shot Result</h2><div class="flex justify-around"><button id="shot-made-btn" class="bg-green-600 p-3 px-6 rounded">Make</button><button id="shot-missed-btn" class="bg-red-600 p-3 px-6 rounded">Miss</button></div></div>`; document.getElementById('shotModal').style.display = 'block'; }
            function logShot(made) { db.basketball.shots.push({ id: Date.now(), ...tempShotData, made, playerId: 1 }); document.getElementById('shotModal').style.display = 'none'; renderBasketball(); }
            function downloadReport() { const { jsPDF } = window.jspdf; const doc = new jsPDF(); const reportContent = document.getElementById('bball-report').innerText; doc.text("Basketball Game Report", 10, 10); doc.text(reportContent, 10, 20, { maxWidth: 180 }); doc.save('game-report.pdf'); }
            function renderTimeline() { const container = document.getElementById('analysis-timeline'); container.innerHTML = ''; if (db.basketball.tags.length === 0) { container.innerHTML = '<p class="text-gray-400">Tagged actions will appear here.</p>'; return; } db.basketball.tags.sort((a,b) => a.time - b.time).forEach(tag => { const player = db.basketball.players.find(p => p.id === tag.playerId); container.innerHTML += `<div class="bg-gray-700 p-2 rounded-lg text-sm"><p><strong class="text-blue-400">${tag.timeFormatted}</strong> - ${player.name}</p><p class="text-gray-300">${tag.category}: ${tag.action}</p></div>`; }); }
            function renderShotChart() { const container = document.getElementById('bball-shot-chart'); container.innerHTML = `<div class="bg-gray-800 p-4 rounded-lg"><h3 class="text-xl font-semibold mb-4">Shot Chart</h3><div id="shot-chart-container"></div></div>`; const chartContainer = container.querySelector('#shot-chart-container'); db.basketball.shots.forEach(shot => { chartContainer.innerHTML += `<div class="shot-dot" style="left: ${shot.x}%; top: ${shot.y}%; background-color: ${shot.made ? '#4ade80' : '#f87171'};"></div>`; }); }
            function renderPlayerStats() { const container = document.getElementById('bball-stats'); let stats = {}; db.basketball.players.forEach(p => { stats[p.id] = { name: p.name, FGM: 0, FGA: 0, AST: 0, PTS: 0 }; }); db.basketball.tags.forEach(tag => { if (!stats[tag.playerId]) return; if (tag.statType === 'fga_made') { stats[tag.playerId].FGM++; stats[tag.playerId].FGA++; } else if (tag.statType === 'fga_missed') stats[tag.playerId].FGA++; else if (tag.statType === 'ast') stats[tag.playerId].AST++; }); Object.values(stats).forEach(p => { p.PTS = (p.FGM * 2); }); let tableHTML = `<div class="bg-gray-800 p-4 rounded-lg"><h3 class="text-xl font-semibold mb-4">Player Stats</h3><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr><th>Player</th><th>PTS</th><th>FGM/A</th><th>AST</th></tr></thead><tbody>`; Object.values(stats).forEach(p => { tableHTML += `<tr><td class="p-2">${p.name}</td><td class="p-2">${p.PTS}</td><td class="p-2">${p.FGM}/${p.FGA}</td><td class="p-2">${p.AST}</td></tr>`; }); tableHTML += '</tbody></table></div></div>'; container.innerHTML = tableHTML; }
            function renderLineupImpact() { const container = document.getElementById('bball-lineups'); let tableHTML = `<div class="bg-gray-800 p-4 rounded-lg"><h3 class="text-xl font-semibold mb-4">Lineup Impact</h3><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr><th>Lineup</th><th>+/-</th></tr></thead><tbody>`; db.basketball.lineups.forEach(lineup => { const playerNames = lineup.players.map(pid => db.basketball.players.find(p => p.id === pid).name).join(', '); tableHTML += `<tr><td class="p-2">${playerNames}</td><td class="p-2 font-bold ${lineup.plusMinus > 0 ? 'text-green-400' : 'text-red-400'}">${lineup.plusMinus > 0 ? '+' : ''}${lineup.plusMinus}</td></tr>`; }); tableHTML += '</tbody></table></div></div>'; container.innerHTML = tableHTML; }
            function renderGameReport() { const container = document.getElementById('bball-report'); container.innerHTML = `<div class="bg-gray-800 p-4 rounded-lg"><h3 class="text-xl font-semibold mb-4">Game Report</h3><div id="report-content" class="prose prose-invert max-w-none"><p>Report content generated here.</p></div><button id="download-report-btn" class="mt-6 bg-blue-600 p-2 rounded">Download PDF</button></div>`; }
            function formatTime(seconds, short = false) { if (isNaN(seconds) || seconds < 0) return "0m"; const h = Math.floor(seconds / 3600); const m = Math.floor((seconds % 3600) / 60); return short ? `${h}h ${m}m` : `${h}h ${m}m`; }
            function formatVideoTime(timeInSeconds) { const minutes = Math.floor(timeInSeconds / 60); const seconds = Math.floor(timeInSeconds % 60); return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; }
            function getColor(colorName) { const colors = { red: '248, 113, 113', green: '74, 222, 128', blue: '96, 165, 250', indigo: '129, 140, 248', purple: '167, 139, 250', yellow: '250, 204, 21', teal: '45, 212, 191' }; return colors[colorName] || colors.blue; }
            function timeToMinutes(timeStr) { const [hours, minutes] = timeStr.split(':').map(Number); return hours * 60 + minutes; }
            
            // --- INITIALIZATION ---
            setupNavigation();
            setupTabNavigation('.gym-tab', '.gym-pane');
            setupTabNavigation('.bball-tab', '.bball-pane');
            renderAll();
        });
    </script>
</body>
</html>
